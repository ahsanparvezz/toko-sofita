{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>Product Detail - Toko Sofita</title>
{% endblock meta %}

{% block content %}
<div class="bg-black w-full min-h-screen text-white">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- Back Navigation -->
    <div class="mb-6">
      <a href="{% url 'main:show_main' %}" class="text-gray-400 hover:text-white font-medium transition-colors">
        ← Back to Products
      </a>
    </div>

    <!-- Product Detail Card -->
    <article id="product-card" class="bg-neutral-900 rounded-lg border border-neutral-700 overflow-hidden hidden">
      <div class="p-6 sm:p-8">
        <div id="badges-container" class="flex flex-wrap items-center gap-2 mb-4"></div>
        <h1 id="product-name" class="text-3xl sm:text-4xl font-bold text-white leading-tight mb-4"></h1>
        <div class="flex flex-wrap items-center text-sm text-gray-400 gap-4">
          <span id="product-price"></span>
          <span id="product-stock"></span>
          <span id="product-rating"></span>
        </div>
      </div>

      <!-- Image -->
      <div class="px-6 sm:px-8">
        <img id="product-thumbnail" class="w-full h-64 sm:h-80 lg:h-96 object-cover rounded-lg" alt="Product image">
      </div>

      <!-- Description -->
      <div class="p-6 sm:p-8">
        <div id="product-description" class="text-gray-300 leading-relaxed whitespace-pre-line text-base sm:text-lg"></div>
      </div>

      <!-- Author Info -->
      <div class="border-t border-neutral-700 p-6 sm:p-8 bg-neutral-800">
        <div class="flex items-center justify-between">
          <div>
            <p id="product-author" class="font-medium text-white"></p>
            <p id="product-upload" class="text-sm text-gray-400"></p>
          </div>
        </div>
      </div>
    </article>

    <div id="loading" class="text-center text-gray-400 mt-10">Loading product...</div>
    <div id="error" class="text-center text-red-500 mt-10 hidden">Product not found.</div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const productId = window.location.pathname.split("/").filter(Boolean).pop();
  const url = `/json/${productId}/`;

  fetch(url)
    .then(response => {
      if (!response.ok) throw new Error("Product not found");
      return response.json();
    })
    .then(product => {
      document.getElementById("product-card").classList.remove("hidden");
      document.getElementById("loading").classList.add("hidden");

      // Badges: category + featured
      const badgesContainer = document.getElementById("badges-container");
      badgesContainer.innerHTML = `
        <span class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium bg-red-600 text-white">
          ${product.category || "Other"}
        </span>
        ${product.is_featured ? `<span class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium bg-yellow-500 text-black">Featured</span>` : ""}
      `;

      // Product info
      document.getElementById("product-name").textContent = product.name;
      document.getElementById("product-price").innerHTML = `<b>Harga:</b> Rp ${Number(product.price || 0).toLocaleString('id-ID')}`;
      document.getElementById("product-stock").innerHTML = `<b>Stok:</b> ${product.stock ?? "N/A"}`;
      document.getElementById("product-rating").innerHTML = product.rating ? `<b>Rating:</b> ⭐ ${product.rating}` : "";

      // Thumbnail
      const thumbnailEl = document.getElementById("product-thumbnail");
      if (product.thumbnail) {
        thumbnailEl.src = product.thumbnail;
      } else {
        thumbnailEl.classList.add("hidden");
      }

      // Description
      document.getElementById("product-description").textContent = product.description || "";

      // Author info
      document.getElementById("product-author").textContent = product.user_username ? `Author: ${product.user_username}` : "Author: Anonymous";
      document.getElementById("product-upload").textContent = product.user_username ? `Uploaded by ${product.user_username}` : "Uploaded by Anonymous";
    })
    .catch(err => {
      console.error(err);
      document.getElementById("loading").classList.add("hidden");
      document.getElementById("error").classList.remove("hidden");
    });
});
</script>
{% endblock content %}
